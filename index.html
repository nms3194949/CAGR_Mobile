<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>雙贏策略｜手機版配息試算＋投組分析</title>
<style>
:root{--deep:#0A1221;--gold:#C9A227;--gold-soft:#E9D18A;--card:#0C152A;--pos:#39C27A;--neg:#E25A5A;--field-bg:#101b33;--input-bg:#071226;--line:rgba(233,209,138,.25);}
html,body{margin:0;background:var(--deep);color:#fff;font-family:"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;}
.wrap{max-width:540px;margin:0 auto;padding:10px;}
.tab{padding:10px 14px;border-radius:10px;border:1px solid rgba(201,162,39,.35);background:rgba(12,21,42,.8);color:#E9D18A;cursor:pointer;font-weight:700;}
.tab[aria-selected="true"]{background:linear-gradient(90deg,var(--gold),var(--gold-soft));color:#0A1221;}
.tabs{display:flex;gap:6px;justify-content:center;margin:10px 0;}
.btn{padding:8px 12px;border-radius:8px;border:0;background:linear-gradient(90deg,var(--gold),var(--gold-soft));color:#0A1221;font-weight:700;}
.field{margin-bottom:10px;}
label{font-size:13px;color:#E9D18A;}
.control{width:100%;height:40px;border-radius:8px;border:1px solid rgba(233,209,138,.12);background:var(--input-bg);color:#fff;font-size:16px;padding:0 10px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:8px 10px;text-align:left;font-size:14px;}
th{color:var(--gold-soft);border-bottom:2px solid rgba(201,162,39,.8);}
td{border-bottom:1px solid var(--line);}
.pos{color:var(--pos);}
.neg{color:var(--neg);}
.gold{color:var(--gold);}
.em{font-weight:700;}
.tabpanel{display:none;}
.tabpanel.active{display:block;}
</style>
</head>
<body>
<div class="wrap">

  <div class="tabs">
    <button class="tab" id="tab-cash" aria-selected="true">每月配息</button>
    <button class="tab" id="tab-portfolio" aria-selected="false">投組分析</button>
  </div>

  <!-- 每月配息試算 -->
  <section class="tabpanel active" id="panel-cash">
    <div class="field"><label>投入本金（$）</label><input id="principal" type="number" class="control" value="1000000"></div>
    <div class="field"><label>融資金額（$）</label><input id="loan" type="number" class="control" value="1500000"></div>
    <div class="field"><label>年化配息率（%）</label><input id="rate" type="number" class="control" value="10.0"></div>
    <div class="field"><label>融資年利率（%）</label><input id="loanRate" type="number" class="control" value="4.0"></div>

    <table>
      <tbody>
        <tr><td>投入本金</td><td id="vPrincipal">—</td></tr>
        <tr><td>融資金額</td><td id="vLoan">—</td></tr>
        <tr><td>總投入</td><td id="vTotal" class="em">—</td></tr>
        <tr><td>年化配息率</td><td id="vRate">—</td></tr>
        <tr><td>每月配息</td><td id="vMonthlyDiv" class="pos">—</td></tr>
        <tr><td>每月利息</td><td id="vMonthlyInt" class="neg">—</td></tr>
        <tr><td>每月淨現金流</td><td id="vMonthlyNet" class="em">—</td></tr>
        <tr><td>預估報酬率（含息）</td><td id="vEstReturn" class="gold">—</td></tr>
      </tbody>
    </table>
  </section>

  <!-- 投組分析 -->
  <section class="tabpanel" id="panel-portfolio">
    <table id="fundInputTable">
      <thead><tr><th>基金</th><th>1年%</th><th>3年%</th><th>5年%</th><th>配息%</th><th>比重%</th></tr></thead>
      <tbody>
        <tr><td><input class="control name" placeholder="基金A"></td><td><input class="control fin r1"></td><td><input class="control fin r3"></td><td><input class="control fin r5"></td><td><input class="control fin dy"></td><td><input class="control fin wt"></td></tr>
        <tr><td><input class="control name" placeholder="基金B"></td><td><input class="control fin r1"></td><td><input class="control fin r3"></td><td><input class="control fin r5"></td><td><input class="control fin dy"></td><td><input class="control fin wt"></td></tr>
        <tr><td><input class="control name" placeholder="基金C"></td><td><input class="control fin r1"></td><td><input class="control fin r3"></td><td><input class="control fin r5"></td><td><input class="control fin dy"></td><td><input class="control fin wt"></td></tr>
        <tr><td><input class="control name" placeholder="基金D"></td><td><input class="control fin r1"></td><td><input class="control fin r3"></td><td><input class="control fin r5"></td><td><input class="control fin dy"></td><td><input class="control fin wt"></td></tr>
        <tr><td><input class="control name" placeholder="基金E"></td><td><input class="control fin r1"></td><td><input class="control fin r3"></td><td><input class="control fin r5"></td><td><input class="control fin dy"></td><td><input class="control fin wt"></td></tr>
      </tbody>
    </table>

    <table style="margin-top:14px;">
      <thead><tr><th>指標</th><th>1年</th><th>3年</th><th>5年</th></tr></thead>
      <tbody>
        <tr><td>含息報酬率</td><td id="pf_cagr1" class="gold">—</td><td id="pf_cagr3" class="gold">—</td><td id="pf_cagr5" class="gold">—</td></tr>
        <tr><td>配息率</td><td id="pf_div1" class="pos">—</td><td id="pf_div3" class="pos">—</td><td id="pf_div5" class="pos">—</td></tr>
        <tr><td>資本成長率</td><td id="pf_cap1" class="em">—</td><td id="pf_cap3" class="em">—</td><td id="pf_cap5" class="em">—</td></tr>
      </tbody>
    </table>
  </section>

  <p style="font-size:12px;color:#aaa;">⚠️ 本頁為試算用途，歷史績效不代表未來。</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
<script>
// 切換頁籤
const tabCash=document.getElementById('tab-cash');
const tabPF=document.getElementById('tab-portfolio');
function setTab(active){
  document.querySelectorAll('.tab').forEach(t=>t.setAttribute('aria-selected','false'));
  document.querySelectorAll('.tabpanel').forEach(p=>p.classList.remove('active'));
  if(active==='cash'){tabCash.setAttribute('aria-selected','true');document.getElementById('panel-cash').classList.add('active');}
  else{tabPF.setAttribute('aria-selected','true');document.getElementById('panel-portfolio').classList.add('active');}
}
tabCash.onclick=()=>setTab('cash'); tabPF.onclick=()=>setTab('pf');

// ===== 每月配息運算 =====
function num(id){return parseFloat(document.getElementById(id).value)||0;}
function computeCashflow(){
  const P=num('principal'),L=num('loan'),r=num('rate'),i=num('loanRate');
  const total=P+L, annualDiv=total*r/100, annualInt=L*i/100;
  const mDiv=annualDiv/12, mInt=annualInt/12, mNet=mDiv-mInt;
  const est=(P>0)?((annualDiv-annualInt)/P):NaN;
  const twd=n=>new Intl.NumberFormat('zh-TW',{style:'currency',currency:'TWD',maximumFractionDigits:0}).format(n);
  document.getElementById('vPrincipal').textContent=twd(P);
  document.getElementById('vLoan').textContent=twd(L);
  document.getElementById('vTotal').textContent=twd(total);
  document.getElementById('vRate').textContent=r.toFixed(2)+'%';
  document.getElementById('vMonthlyDiv').textContent=twd(mDiv);
  document.getElementById('vMonthlyInt').textContent=twd(mInt);
  document.getElementById('vMonthlyNet').textContent=twd(mNet);
  document.getElementById('vEstReturn').textContent=isFinite(est)?(est*100).toFixed(2)+'%':'—';
}

// ===== 投組分析 =====
function cagrFromTotal(total,yrs){const x=parseFloat(total);if(!isFinite(x))return NaN;return Math.pow(1+x/100,1/yrs)-1;}
function recomputePortfolio(){
  const rows=document.querySelectorAll('#fundInputTable tbody tr');
  let sumW=0,data=[];
  rows.forEach(tr=>{
    const r1=parseFloat(tr.querySelector('.r1').value),r3=parseFloat(tr.querySelector('.r3').value),
          r5=parseFloat(tr.querySelector('.r5').value),dy=parseFloat(tr.querySelector('.dy').value),
          wt=parseFloat(tr.querySelector('.wt').value);
    if(isFinite(wt)&&wt>0)sumW+=wt;
    data.push({r1,r3,r5,dy,wt});
  });
  let c1=0,c3=0,c5=0,dy=0,ws=0;
  data.forEach(f=>{
    const w=(sumW>0?f.wt/sumW:0);
    const c1v=isFinite(f.r1)?f.r1/100:NaN;
    const c3v=isFinite(f.r3)?cagrFromTotal(f.r3,3):NaN;
    const c5v=isFinite(f.r5)?cagrFromTotal(f.r5,5):NaN;
    const dyv=isFinite(f.dy)?f.dy/100:NaN;
    if(isFinite(c1v)){c1+=c1v*w;ws+=w;}
    if(isFinite(c3v))c3+=c3v*w;
    if(isFinite(c5v))c5+=c5v*w;
    if(isFinite(dyv))dy+=dyv*w;
  });
  const cap1=c1-dy,cap3=c3-dy,cap5=c5-dy;
  const set=(id,v)=>document.getElementById(id).textContent=isFinite(v)?(v*100).toFixed(2)+'%':'—';
  set('pf_cagr1',c1);set('pf_cagr3',c3);set('pf_cagr5',c5);
  set('pf_div1',dy);set('pf_div3',dy);set('pf_div5',dy);
  set('pf_cap1',cap1);set('pf_cap3',cap3);set('pf_cap5',cap5);
}

// ===== 初始化，保證 iPhone Safari 可自動執行 =====
function boot(){
  computeCashflow();
  document.querySelectorAll('.control').forEach(el=>el.addEventListener('input',()=>{computeCashflow();recomputePortfolio();}));
  recomputePortfolio();
}
document.addEventListener('DOMContentLoaded',boot,{once:true});
window.addEventListener('pageshow',e=>{if(e.persisted)boot();});
</script>
</body>
</html>
